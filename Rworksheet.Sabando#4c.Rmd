---
title: "Rworksheet.Sabando#4c.Rmd"
author: "Samantha L. Sabando"
date: "2025-12-07"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
############################################
# 1. Import mpg dataset and identify variable types
############################################
library(dplyr)
library(ggplot2)
library(tidyr)
library(readxl)

# Import dataset
data(mpg)
write.csv(mpg, "mpg.csv", row.names = FALSE)
mpgdata <- read.csv("mpg.csv", header = TRUE, stringsAsFactors = FALSE)

# a. Import CSV shown above
# b. Categorical variables: manufacturer, model, trans, drv, fl, class, year
# c. Continuous variables: displ, cty, hwy

############################################
# 2. Which manufacturer has the most models? Which model has most variations?
############################################
# a. Group manufacturers and find unique models
manumodels <- mpgdata %>%
  group_by(manufacturer) %>%
  summarise(totalmodels = n_distinct(model)) %>%
  arrange(desc(totalmodels))
manumodels

modelvars <- mpgdata %>%
  group_by(model) %>%
  summarise(totalvars = n()) %>%
  arrange(desc(totalvars))
modelvars

# b. Graph the result
plot(as.factor(manumodels$manufacturer), manumodels$totalmodels, las = 2,
     main = "Number of Unique Models per Manufacturer",
     xlab = "Manufacturer",
     ylab = "Number of Models")

ggplot(manumodels, aes(x = reorder(manufacturer, -totalmodels), y = totalmodels)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Unique Models per Manufacturer",
       x = "Manufacturer",
       y = "Number of Unique Models") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

############################################
# 3. Relationship of model and manufacturer
############################################
ggplot(mpgdata, aes(x = model, y = manufacturer)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Relationship between Model and Manufacturer",
       x = "Model",
       y = "Manufacturer")

# Improved plot with counts
ggplot(mpgdata, aes(x = model, y = manufacturer)) +
  geom_count() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Count of Each Model per Manufacturer",
       x = "Model",
       y = "Manufacturer")

############################################
# 4. Plot model vs year (top 20 observations)
############################################
top20data <- mpgdata[1:20, ]
ggplot(top20data, aes(x = model, y = factor(year))) +
  geom_point(color = "blue", size = 3) +
  labs(title = "Model vs Year (Top 20 Observations)",
       x = "Model",
       y = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

############################################
# 5. Number of cars per model and plots
############################################
modelcount <- mpgdata %>%
  group_by(model) %>%
  summarise(carnum = n()) %>%
  arrange(desc(carnum))
top20models <- modelcount[1:20, ]

# a. Bar plot
ggplot(top20models, aes(x = reorder(model, -carnum), y = carnum, fill = model)) +
  geom_bar(stat = "identity") +
  labs(title = "Top 20 Models by Number of Cars",
       x = "Model",
       y = "Number of Cars") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_brewer(palette = "Set3")

# b. Flipped bar plot
ggplot(top20models, aes(x = reorder(model, carnum), y = carnum, fill = model)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top 20 Models by Number of Cars",
       x = "Model",
       y = "Number of Cars") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")

############################################
# 6. Relationship between cylinders and engine displacement
############################################
############################################
# 6. TRAFFIC DATASET
############################################
# Import traffic data
traffic <- read.csv("traffic.csv", header = TRUE, stringsAsFactors = FALSE)

# a. Number of observations and variables
cat("Traffic dataset dimensions (rows, cols):", dim(traffic), "\n")
cat("Traffic dataset variables:", names(traffic), "\n\n")

# b. Subset the dataset into junctions (long format)
traffic_long <- traffic %>%
  pivot_longer(cols = starts_with("Junction"),
               names_to = "Junction",
               values_to = "Vehicles")

# Example: show first few rows of Junction1
junction1 <- traffic_long %>% filter(Junction == "Junction1")
cat("Subset of Junction1:\n")
print(head(junction1))
cat("\n")

# c. Plot each junction using geom_line()
ggplot(traffic_long, aes(x = Time, y = Vehicles, color = Junction)) +
  geom_line(size = 1.2) +
  labs(title = "Traffic Volume per Junction",
       x = "Time",
       y = "Number of Vehicles") +
  theme_minimal()

# Relationship between displ and hwy
ggplot(mpgdata, aes(x = displ, y = hwy, color = displ)) +
  geom_point(size = 3) +
  labs(title = "Engine Displacement vs Highway MPG",
       x = "Engine Displacement (litres)",
       y = "Highway MPG",
       color = "Displacement") +
  theme_minimal()

# Shows negative correlation: larger engines → lower highway MPG

############################################
# 7. Traffic dataset
############################################
traffic <- read.csv("traffic.csv", header = TRUE, stringsAsFactors = FALSE)
cat("Traffic dataset dimensions (rows, cols):", dim(traffic), "\n")
cat("Traffic dataset variables:", names(traffic), "\n")

# Reshape wide → long for plotting
traffic_long <- traffic %>%
  pivot_longer(cols = starts_with("Junction"),
               names_to = "Junction",
               values_to = "Vehicles")
head(traffic_long)

# Plot each junction using geom_line
ggplot(traffic_long, aes(x = Time, y = Vehicles, color = Junction)) +
  geom_line(size = 1.2) +
  labs(title = "Traffic Volume per Junction",
       x = "Time",
       y = "Number of Vehicles") +
  theme_minimal()

############################################
# 7. Alexa dataset
############################################
alexa <- read_excel("alexa_file.xlsx")
cat("Alexa dataset dimensions (rows, cols):", dim(alexa), "\n")

# Group variations and total per variation
variation_summary <- alexa %>%
  group_by(variation) %>%
  summarise(total_reviews = n())
cat("Total reviews per variation:\n")
print(variation_summary)

# Plot variations
ggplot(variation_summary, aes(x = variation, y = total_reviews, fill = variation)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Reviews per Variation",
       x = "Variation",
       y = "Total Reviews") +
  theme_minimal()

# Verified reviews over time
ggplot(alexa, aes(x = date, y = verified_reviews)) +
  geom_line(color = "blue") +
  labs(title = "Verified Reviews Over Time",
       x = "Date",
       y = "Number of Verified Reviews") +
  theme_minimal()

# Relationship between variations and ratings
variation_rating <- alexa %>%
  group_by(variation) %>%
  summarise(avg_rating = mean(rating, na.rm = TRUE))
cat("Average rating per variation:\n")
print(variation_rating)

# Plot average rating per variation
ggplot(variation_rating, aes(x = variation, y = avg_rating, fill = variation)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Rating per Variation",
       x = "Variation",
       y = "Average Rating") +
  theme_minimal()
```
